<UserControl x:Class="PharmacyStockManager.Views.PurchasesControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:converter="clr-namespace:PharmacyStockManager.Converters"
             Background="White">
    <UserControl.Resources>
        <converter:RowNumberToSerialNumberConverter x:Key="RowIndexConverter"/>
    </UserControl.Resources>
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Border Grid.Row="0" Background="#F7F7F7" Padding="10" CornerRadius="5" Margin="0,0,0,10">
            <DockPanel>

                <StackPanel Orientation="Horizontal" DockPanel.Dock="Right" HorizontalAlignment="Right">
                    <Button Content="Add" Width="80" Height="30" Command="{Binding AddCommand}"
                        Background="Orange" Foreground="White" FontWeight="SemiBold" Margin="5,0"
                        Style="{StaticResource RoundedActionButton}" BorderBrush="Transparent" Cursor="Hand"/>

                    <Button Content="Refresh" Width="80" Height="30" Command="{Binding RefreshCommand}"
                        Background="LightGray" Foreground="Black" FontWeight="SemiBold" Margin="5,0"
                        Style="{StaticResource RoundedActionButton}" BorderBrush="Transparent" Cursor="Hand"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" DockPanel.Dock="Left">
                    <TextBlock Text="Search:" VerticalAlignment="Center" FontWeight="SemiBold" Margin="0,0,5,0"/>
                    <TextBox Width="200" Height="28" VerticalContentAlignment="Center"
                         Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,5,0"/>
                </StackPanel>

            </DockPanel>
        </Border>

        <DataGrid x:Name="dgPurchases" Grid.Row="1"
              ItemsSource="{Binding Purchases}"
              Style="{StaticResource FlatDataGridStyle}"
              Margin="0">

            <DataGrid.Columns>

                <DataGridTextColumn Header="Sr No."
                Binding="{Binding RelativeSource={RelativeSource AncestorType=DataGridRow}, Converter={StaticResource RowIndexConverter}}" 
                Width="50"/>

                <DataGridTextColumn Header="Invoice No." Binding="{Binding InvoiceNumber}" Width="2*"/>

                <DataGridTextColumn Header="Supplier" Binding="{Binding Supplier.SupplierName}" Width="2*"/>

                <DataGridTextColumn Header="Purchase Date" Binding="{Binding PurchaseDate,StringFormat=dd/MM/yyyy}" Width="150"/>

                <DataGridTextColumn Header="Total Amount" Binding="{Binding TotalAmount}" Width="120"/>

                <DataGridTextColumn Header="Purchased By"
                                 Binding="{Binding PurchasedByNavigation.Username}"
                                 Width="150"/>

                <DataGridTextColumn Header="Modified By"
                                 Binding="{Binding ModifiedByNavigation.Username}"
                                 Width="150"/>

                <DataGridTextColumn Header="Modified At"
                                 Binding="{Binding ModifiedAt}"
                                 Width="150"/>
                <DataGridTemplateColumn Header="Invoice" Width="120">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Button Background="Transparent" BorderBrush="Transparent" Cursor="Hand" Command="{Binding DataContext.ViewInvoiceCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}" CommandParameter="{Binding}">

                                <Button.Template>
                                    <ControlTemplate TargetType="Button">
                                        <TextBlock x:Name="txt" Text="View" Foreground="Blue" TextDecorations="Underline" Cursor="Hand" Padding="2,0"/>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="txt" Property="Foreground" Value="#0056B3"/>
                                                <!-- darker blue -->
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Button.Template>

                            </Button>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                <DataGridTemplateColumn Header="Actions" Width="120">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                <Button Command="{Binding DataContext.EditCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                    CommandParameter="{Binding}" Background="Transparent" ToolTip="Edit" BorderBrush="Transparent">
                                    <Image Source="pack://application:,,,/PharmacyStockManager;component/Resources/Icons/edit_icon.png"/>
                                </Button>

                                <Button Command="{Binding DataContext.DeleteCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                    CommandParameter="{Binding}" ToolTip="Delete" Margin="5,0,0,0"
                                    Background="Transparent" BorderBrush="Transparent">
                                    <Image Source="pack://application:,,,/PharmacyStockManager;component/Resources/Icons/delete_icon.png"/>
                                </Button>
                            </StackPanel>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

            </DataGrid.Columns>
        </DataGrid>
    </Grid>

</UserControl>
