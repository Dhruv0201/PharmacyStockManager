<UserControl x:Class="PharmacyStockManager.Views.CategoriesControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:PharmacyStockManager.ViewModel"
             xmlns:converter="clr-namespace:PharmacyStockManager.Converters"
             Background="White">
    <UserControl.Resources>
        <converter:RowNumberToSerialNumberConverter x:Key="RowIndexConverter"/>
    </UserControl.Resources>

    <Grid Margin="5">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Header -->
            <RowDefinition Height="Auto"/>
            <!-- Filters + CRUD -->
            <RowDefinition Height="*"/>
            <!-- DataGrid -->
        </Grid.RowDefinitions>

        <!-- HEADER BAR -->
        <Border Grid.Row="0" Background="White" CornerRadius="7" Padding="10" Margin="0,0,0,10">
            <DockPanel>
                <TextBlock Text="Manage Categories"
                           Foreground="Black"
                           FontWeight="SemiBold"
                           FontSize="16"
                           VerticalAlignment="Center"
                           DockPanel.Dock="Left"/>
            </DockPanel>
        </Border>

        <!-- FILTERS + CRUD -->
        <Border Grid.Row="1" Background="#F7F7F7" Padding="10" CornerRadius="5" Margin="0,0,0,10">
            <DockPanel>
                <!-- Right side buttons -->
                <StackPanel Orientation="Horizontal" DockPanel.Dock="Right" HorizontalAlignment="Right">
                    <Button Content="Add" Width="80" Height="30" Command="{Binding AddCommand}" 
                            Background="Orange" Foreground="White" FontWeight="SemiBold" Margin="5,0" 
                            Style="{StaticResource RoundedActionButton}"
                            BorderBrush="Transparent" Cursor="Hand"/>
                    <Button Content="Refresh" Width="80" Height="30" Command="{Binding RefreshCommand}"
                            Background="LightGray" Foreground="Black" FontWeight="SemiBold" Margin="5,0" 
                            Style="{StaticResource RoundedActionButton}"
                            BorderBrush="Transparent" Cursor="Hand"/>
                </StackPanel>

                <!-- Left side search -->
                <StackPanel Orientation="Horizontal" DockPanel.Dock="Left">
                    <TextBlock Text="Search:" VerticalAlignment="Center" FontWeight="SemiBold" Margin="0,0,5,0"/>
                    <TextBox Width="200" Height="28" VerticalContentAlignment="Center"
                             Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,5,0"/>
                </StackPanel>
            </DockPanel>
        </Border>

        <!-- DATAGRID -->
        <DataGrid x:Name="dgCategories"
                  Grid.Row="2"
                  ItemsSource="{Binding Categories}"
                  Style="{StaticResource FlatDataGridStyle}"
                        Margin="0">


            <DataGrid.Columns>
                <DataGridTextColumn Header="Sr No." Binding="{Binding RelativeSource={RelativeSource AncestorType=DataGridRow}, Converter={StaticResource RowIndexConverter}}" Width="50"
                         />
                <DataGridTextColumn Header="Name" Binding="{Binding CategoryName}" Width="2*"
                         />
                <DataGridTextColumn Header="Description" Binding="{Binding Description}" Width="3*"
                         />

                <!-- Actions column with icons -->
                <DataGridTemplateColumn Header="Actions" Width="120">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,0">
                                <!-- Edit -->
                                <Button Command="{Binding DataContext.EditCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
            CommandParameter="{Binding}" ToolTip="Edit" BorderBrush="Transparent" Background="Transparent" Cursor="Hand">
                                    <Image Source="pack://application:,,,/PharmacyStockManager;component/Resources/Icons/edit_icon.png"
               Width="18" Height="18"
               Stretch="Uniform"
               SnapsToDevicePixels="True"
               RenderOptions.BitmapScalingMode="HighQuality"/>
                                </Button>

                                <!-- Delete -->
                                <Button Command="{Binding DataContext.DeleteCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
            CommandParameter="{Binding}" ToolTip="Delete" Margin="5,0,0,0" Background="Transparent" BorderBrush="Transparent" Cursor="Hand">
                                    <Image Source="pack://application:,,,/PharmacyStockManager;component/Resources/Icons/delete_icon.png"
               Width="20" Height="20"
               Stretch="Uniform"
               SnapsToDevicePixels="True"
               RenderOptions.BitmapScalingMode="HighQuality"/>
                                </Button>
                            </StackPanel>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>
    </Grid>
</UserControl>
